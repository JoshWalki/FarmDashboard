<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Farming Dashboard</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/bootstrap/5.3.2/css/bootstrap.min.css">
    <link rel="stylesheet" href="https://cdn.datatables.net/1.13.7/css/dataTables.bootstrap5.min.css">
    <link rel="stylesheet" href="https://cdn.datatables.net/buttons/2.4.2/css/buttons.bootstrap5.min.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/bootstrap-icons/1.11.1/font/bootstrap-icons.min.css">
    <link rel="stylesheet" href="styles.css">
</head>
<body class="bg-dark text-light" data-bs-theme="dark">
    <!-- Back Home Button - Fixed Position -->
    <button id="back-home-btn" class="btn btn-outline-farm-accent btn-back-home d-none" onclick="dashboard.showLanding()">
        <i class="bi bi-house-door me-1"></i>Home
    </button>

    <div class="container-fluid py-4">
        <!-- Header -->
        <div class="row mb-4">
            <div class="col-12 text-center">
                <h1 class="display-4 text-success mb-2">
                    <i class="bi bi-clipboard-data me-2"></i>
                    Farming Dashboard
                </h1>
                <p class="lead text-muted">Comprehensive farm management</p>
            </div>
        </div>

        <!-- Folder Selection Card -->
        <div class="row mb-4">
            <div class="col-12">
                <div id="folder-selection" class="card shadow-sm border-farm-accent">
                    <div class="card-header bg-farm-primary text-white">
                        <h5 class="card-title mb-0">
                            <i class="bi bi-folder2-open me-2"></i>
                            Select Save Folder
                        </h5>
                    </div>
                    <div class="card-body">
                        <div class="row align-items-center">
                            <div class="col-md-8">
                                <input type="file" class="d-none" id="folder-input" webkitdirectory directory multiple>
                                <label for="folder-input" class="btn btn-farm-accent me-2">
                                    <i class="bi bi-folder-plus me-1"></i>
                                    Choose Save Folder
                                </label>
                                <button id="clear-folder-btn" class="btn btn-danger d-none">
                                    <i class="bi bi-trash me-1"></i>
                                    Clear Saved Data
                                </button>
                            </div>
                            <div class="col-md-4">
                                <span id="folder-path" class="text-muted fst-italic">No folder selected</span>
                            </div>
                        </div>
                        <div class="mt-3">
                            <small class="text-muted">
                                <i class="bi bi-info-circle me-1"></i>
                                Select your Farming Simulator save folder.<br>
                                C:\Users\[YOURUSERNAME]\AppData\Local\Packages\GIANTSSoftware.FarmingSimulator25PC_fa8jxm5fj0esw\LocalCache\Local\save
                            </small>
                            <div class="mt-2">
                                <small class="text-warning">
                                    <i class="bi bi-exclamation-triangle me-1"></i>
                                    <strong>Important:</strong> Farming Simulator must be open with the save loaded before selecting the folder.
                                </small>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Landing Page -->
        <div id="landing-page" class="d-none">
            <div class="row mb-4">
                <div class="col-12 text-center">
                    <h2 class="text-success mb-3">
                        <i class="bi bi-speedometer2 me-2"></i>
                        Farm Management Dashboard
                    </h2>
                    <p class="lead text-muted">Select a section below to manage your farm data</p>
                </div>
            </div>

            <!-- Navigation Cards -->
            <div class="row g-4">
                <div class="col-md-6 col-lg-4">
                    <div class="card bg-secondary h-100 dashboard-nav-card" onclick="dashboard.showSection('livestock')">
                        <div class="card-body text-center p-4">
                            <div class="mb-3">
                                <i class="bi bi-clipboard-data display-1 text-farm-accent"></i>
                            </div>
                            <h4 class="card-title text-farm-accent">Livestock</h4>
                            <p class="card-text text-muted">Manage your animals, track health, breeding, and locations</p>
                            <div class="mt-3">
                                <span class="badge bg-farm-success" id="livestock-count">Loading...</span>
                            </div>
                        </div>
                    </div>
                </div>

                <div class="col-md-6 col-lg-4">
                    <div class="card bg-secondary h-100 dashboard-nav-card" onclick="dashboard.showSection('vehicles')">
                        <div class="card-body text-center p-4">
                            <div class="mb-3">
                                <i class="bi bi-truck display-1 text-farm-accent"></i>
                            </div>
                            <h4 class="card-title text-farm-accent">Vehicles</h4>
                            <p class="card-text text-muted">View your fleet, maintenance status, and operating times</p>
                            <div class="mt-3">
                                <span class="badge bg-farm-secondary" id="vehicle-count">Loading...</span>
                            </div>
                        </div>
                    </div>
                </div>

                <div class="col-md-6 col-lg-4">
                    <div class="card bg-secondary h-100 dashboard-nav-card" onclick="dashboard.showSection('fields')">
                        <div class="card-body text-center p-4">
                            <div class="mb-3">
                                <i class="bi bi-geo-alt display-1 text-farm-accent"></i>
                            </div>
                            <h4 class="card-title text-farm-accent">Fields</h4>
                            <p class="card-text text-muted">Monitor crop growth, soil conditions, and field management</p>
                            <div class="mt-3">
                                <span class="badge bg-farm-warning" id="field-count">Loading...</span>
                            </div>
                        </div>
                    </div>
                </div>

                <div class="col-md-6 col-lg-4">
                    <div class="card bg-secondary h-100 dashboard-nav-card" onclick="dashboard.showSection('economy')">
                        <div class="card-body text-center p-4">
                            <div class="mb-3">
                                <i class="bi bi-graph-up display-1 text-farm-accent"></i>
                            </div>
                            <h4 class="card-title text-farm-accent">Economy</h4>
                            <p class="card-text text-muted">Track commodity prices, market trends, and finances</p>
                            <div class="mt-3">
                                <span class="badge bg-farm-info" id="economy-info">Market Data</span>
                            </div>
                        </div>
                    </div>
                </div>

                <div class="col-md-6 col-lg-4">
                    <div class="card bg-secondary h-100 dashboard-nav-card" onclick="dashboard.showSection('properties')">
                        <div class="card-body text-center p-4">
                            <div class="mb-3">
                                <i class="bi bi-map display-1 text-farm-accent"></i>
                            </div>
                            <h4 class="card-title text-farm-accent">Properties</h4>
                            <p class="card-text text-muted">Manage buildings, storage, and farm infrastructure</p>
                            <div class="mt-3">
                                <span class="badge bg-farm-danger" id="property-count">Loading...</span>
                            </div>
                        </div>
                    </div>
                </div>

                <div class="col-md-6 col-lg-4">
                    <div class="card bg-secondary h-100 dashboard-nav-card" onclick="dashboard.showSection('statistics')">
                        <div class="card-body text-center p-4">
                            <div class="mb-3">
                                <i class="bi bi-bar-chart display-1 text-farm-accent"></i>
                            </div>
                            <h4 class="card-title text-farm-accent">Statistics</h4>
                            <p class="card-text text-muted">View comprehensive farm analytics and performance data</p>
                            <div class="mt-3">
                                <span class="badge bg-farm-primary" id="stats-info">Analytics</span>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Section Content -->
        <div id="section-content" class="d-none">
            <!-- Back to Landing Button -->
            <div class="row mb-4">
                <div class="col-12">
                    <button class="btn btn-outline-farm-accent" onclick="dashboard.showLanding()">
                        <i class="bi bi-arrow-left me-2"></i>Back to Dashboard
                    </button>
                </div>
            </div>

            <!-- Dynamic section content will be loaded here -->
        </div>

        <!-- Dashboard Content (Legacy - keeping for livestock section) -->
        <div id="dashboard-content" class="d-none">
            <!-- Navigation Tabs -->
            <div class="row mb-4">
                <div class="col-12">
                    <ul class="nav nav-pills nav-fill" id="dashboard-tabs" role="tablist">
                        <li class="nav-item" role="presentation">
                            <button class="nav-link active" id="animals-tab-btn" data-bs-toggle="pill" data-bs-target="#animals-tab" type="button" role="tab">
                                <i class="bi bi-clipboard-data me-2"></i>Animals
                            </button>
                        </li>
                        <li class="nav-item" role="presentation">
                            <button class="nav-link" id="statistics-tab-btn" data-bs-toggle="pill" data-bs-target="#statistics-tab" type="button" role="tab">
                                <i class="bi bi-bar-chart me-2"></i>Statistics
                            </button>
                        </li>
                        <li class="nav-item" role="presentation">
                            <button class="nav-link" id="genetics-tab-btn" data-bs-toggle="pill" data-bs-target="#genetics-tab" type="button" role="tab">
                                <i class="bi bi-dna me-2"></i>Genetics
                            </button>
                        </li>
                    </ul>
                </div>
            </div>

            <!-- Tab Content -->
            <div class="tab-content" id="dashboard-tab-content">
                <!-- Animals Tab -->
                <div class="tab-pane fade show active mt-5" id="animals-tab" role="tabpanel">

                    <!-- Summary Cards -->
                    <div class="row mb-4" id="animals-summary">
                        <div class="col-md-3 mb-3">
                            <div class="card bg-farm-primary text-white border-0 summary-card-clickable" onclick="dashboard.filterAnimals('all')" data-filter="all">
                                <div class="card-body">
                                    <div class="d-flex justify-content-between">
                                        <div>
                                            <h6 class="card-title">Total Animals</h6>
                                            <h2 class="mb-0" id="total-count">0</h2>
                                        </div>
                                        <div class="align-self-center">
                                            <i class="bi bi-clipboard-data fs-1"></i>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                        <div class="col-md-3 mb-3">
                            <div class="card bg-farm-info text-white border-0 summary-card-clickable" onclick="dashboard.filterAnimals('lactating')" data-filter="lactating">
                                <div class="card-body">
                                    <div class="d-flex justify-content-between">
                                        <div>
                                            <h6 class="card-title">Lactating</h6>
                                            <h2 class="mb-0" id="lactating-count">0</h2>
                                        </div>
                                        <div class="align-self-center">
                                            <i class="bi bi-droplet fs-1"></i>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                        <div class="col-md-3 mb-3">
                            <div class="card bg-farm-warning text-white border-0 summary-card-clickable" onclick="dashboard.filterAnimals('pregnant')" data-filter="pregnant">
                                <div class="card-body">
                                    <div class="d-flex justify-content-between">
                                        <div>
                                            <h6 class="card-title">Pregnant</h6>
                                            <h2 class="mb-0" id="pregnant-count">0</h2>
                                        </div>
                                        <div class="align-self-center">
                                            <i class="bi bi-heart fs-1"></i>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                        <div class="col-md-3 mb-3">
                            <div class="card bg-farm-success text-white border-0 summary-card-clickable" onclick="dashboard.filterAnimals('health')" data-filter="health">
                                <div class="card-body">
                                    <div class="d-flex justify-content-between">
                                        <div>
                                            <h6 class="card-title">Avg Health</h6>
                                            <h2 class="mb-0" id="avg-health">0%</h2>
                                        </div>
                                        <div class="align-self-center">
                                            <i class="bi bi-heart-pulse fs-1"></i>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- Animals Table -->
                    <div class="row">
                        <div class="col-12">
                            <div class="card shadow-lg border-farm-accent">
                                <div class="card-header bg-farm-primary text-white">
                                    <h5 class="card-title mb-0">
                                        <i class="bi bi-table me-2"></i>
                                        Animals List
                                    </h5>
                                </div>
                                <div class="card-body p-0">
                                    <div class="table-responsive">
                                        <table id="animals-table" class="table table-dark table-striped table-hover mb-0">
                                            <thead class="bg-farm-accent text-dark">
                                                <tr>
                                                    <th>Name</th>
                                                    <th>Type</th>
                                                    <th>Age</th>
                                                    <th>Gender</th>
                                                    <th>Health</th>
                                                    <th>Weight</th>
                                                    <th>Reproduction</th>
                                                    <th>Status</th>
                                                    <th>Location</th>
                                                    <th>Actions</th>
                                                </tr>
                                            </thead>
                                            <tbody id="animals-tbody">
                                            </tbody>
                                        </table>
                                    </div>
                                </div>
                                <div class="card-footer bg-dark border-0 text-center">
                                    <button class="btn btn-outline-farm-accent" onclick="dashboard.showExportModal()">
                                        <i class="bi bi-download me-2"></i>Export Data
                                    </button>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Statistics Tab -->
                <div class="tab-pane fade" id="statistics-tab" role="tabpanel">
                    <div class="card shadow-lg border-warning">
                        <div class="card-header bg-warning text-dark">
                            <h5 class="card-title mb-0">
                                <i class="bi bi-bar-chart me-2"></i>
                                Farm Statistics
                            </h5>
                        </div>
                        <div class="card-body">
                            <div id="stats-content">
                                <canvas id="stats-chart" width="400" height="200"></canvas>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Genetics Tab -->
                <div class="tab-pane fade" id="genetics-tab" role="tabpanel">
                    <div class="card shadow-lg border-info">
                        <div class="card-header bg-info text-white">
                            <h5 class="card-title mb-0">
                                <i class="bi bi-dna me-2"></i>
                                Genetics Overview
                            </h5>
                        </div>
                        <div class="card-body">
                            <div id="genetics-content">
                                <p class="text-muted">Genetic data and breeding recommendations will appear here.</p>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Farm Selection Modal -->
        <div class="modal fade" id="farmSelectionModal" tabindex="-1" aria-labelledby="farmSelectionModalLabel" aria-hidden="true" data-bs-backdrop="static" data-bs-keyboard="false">
            <div class="modal-dialog modal-dialog-centered">
                <div class="modal-content bg-dark text-light">
                    <div class="modal-header bg-farm-primary">
                        <h5 class="modal-title" id="farmSelectionModalLabel">
                            <i class="bi bi-house-door me-2"></i>
                            Select Farm
                        </h5>
                    </div>
                    <div class="modal-body">
                        <p class="text-muted mb-3">
                            <i class="bi bi-info-circle me-2"></i>
                            Multiple farms found in this save file. Please select which farm's data you want to view:
                        </p>
                        <div class="list-group" id="farm-selection-list">
                            <!-- Farm options will be populated here -->
                        </div>
                    </div>
                    <div class="modal-footer">
                        <small class="text-muted me-auto">You can change this selection later from the dashboard</small>
                    </div>
                </div>
            </div>
        </div>

        <!-- Export Data Modal -->
        <div class="modal fade" id="exportDataModal" tabindex="-1" aria-labelledby="exportDataModalLabel" aria-hidden="true">
            <div class="modal-dialog modal-dialog-centered">
                <div class="modal-content bg-dark text-light">
                    <div class="modal-header bg-farm-primary">
                        <h5 class="modal-title" id="exportDataModalLabel">
                            <i class="bi bi-download me-2"></i>
                            Export Livestock Data
                        </h5>
                        <button type="button" class="btn-close btn-close-white" data-bs-dismiss="modal"></button>
                    </div>
                    <div class="modal-body">
                        <p class="text-muted mb-4">
                            <i class="bi bi-info-circle me-2"></i>
                            Choose your preferred export format for the livestock data:
                        </p>

                        <div class="row g-3">
                            <div class="col-12">
                                <button class="btn btn-outline-farm-accent w-100 py-3" onclick="dashboard.exportData('csv')">
                                    <div class="d-flex align-items-center justify-content-between">
                                        <div class="d-flex align-items-center">
                                            <i class="bi bi-file-earmark-spreadsheet fs-4 me-3"></i>
                                            <div class="text-start">
                                                <div class="fw-bold">CSV (Comma-Separated Values)</div>
                                                <small class="text-muted">Compatible with Excel, Google Sheets</small>
                                            </div>
                                        </div>
                                        <i class="bi bi-arrow-right"></i>
                                    </div>
                                </button>
                            </div>

                            <div class="col-12">
                                <button class="btn btn-outline-farm-accent w-100 py-3" onclick="dashboard.exportData('excel')">
                                    <div class="d-flex align-items-center justify-content-between">
                                        <div class="d-flex align-items-center">
                                            <i class="bi bi-file-earmark-excel fs-4 me-3"></i>
                                            <div class="text-start">
                                                <div class="fw-bold">Excel (.xlsx)</div>
                                                <small class="text-muted">Microsoft Excel format with formatting</small>
                                            </div>
                                        </div>
                                        <i class="bi bi-arrow-right"></i>
                                    </div>
                                </button>
                            </div>

                            <div class="col-12">
                                <button class="btn btn-outline-farm-accent w-100 py-3" onclick="dashboard.exportData('pdf')">
                                    <div class="d-flex align-items-center justify-content-between">
                                        <div class="d-flex align-items-center">
                                            <i class="bi bi-file-earmark-pdf fs-4 me-3"></i>
                                            <div class="text-start">
                                                <div class="fw-bold">PDF Document</div>
                                                <small class="text-muted">Printable report format</small>
                                            </div>
                                        </div>
                                        <i class="bi bi-arrow-right"></i>
                                    </div>
                                </button>
                            </div>

                            <div class="col-12">
                                <button class="btn btn-outline-farm-accent w-100 py-3" onclick="dashboard.exportData('print')">
                                    <div class="d-flex align-items-center justify-content-between">
                                        <div class="d-flex align-items-center">
                                            <i class="bi bi-printer fs-4 me-3"></i>
                                            <div class="text-start">
                                                <div class="fw-bold">Print Preview</div>
                                                <small class="text-muted">Print directly from browser</small>
                                            </div>
                                        </div>
                                        <i class="bi bi-arrow-right"></i>
                                    </div>
                                </button>
                            </div>
                        </div>
                    </div>
                    <div class="modal-footer">
                        <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cancel</button>
                    </div>
                </div>
            </div>
        </div>

        <!-- Animal Details Modal -->
        <div class="modal fade" id="animalDetailsModal" tabindex="-1" aria-labelledby="animalDetailsModalLabel" aria-hidden="true">
            <div class="modal-dialog modal-lg">
                <div class="modal-content bg-dark text-light">
                    <div class="modal-header bg-farm-primary">
                        <h5 class="modal-title" id="animalDetailsModalLabel">
                            <i class="bi bi-clipboard-data me-2"></i>
                            Animal Details
                        </h5>
                        <button type="button" class="btn-close btn-close-white" data-bs-dismiss="modal"></button>
                    </div>
                    <div class="modal-body">
                        <div id="animalDetailsContent">
                            <!-- Animal details will be loaded here -->
                        </div>
                    </div>
                    <div class="modal-footer">
                        <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Close</button>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <script src="https://code.jquery.com/jquery-3.7.1.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/bootstrap/5.3.2/js/bootstrap.bundle.min.js"></script>
    <script src="https://cdn.datatables.net/1.13.7/js/jquery.dataTables.min.js"></script>
    <script src="https://cdn.datatables.net/1.13.7/js/dataTables.bootstrap5.min.js"></script>
    <script src="https://cdn.datatables.net/buttons/2.4.2/js/dataTables.buttons.min.js"></script>
    <script src="https://cdn.datatables.net/buttons/2.4.2/js/buttons.bootstrap5.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jszip/3.10.1/jszip.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/pdfmake/0.1.53/pdfmake.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/pdfmake/0.1.53/vfs_fonts.js"></script>
    <script src="https://cdn.datatables.net/buttons/2.4.2/js/buttons.html5.min.js"></script>
    <script src="https://cdn.datatables.net/buttons/2.4.2/js/buttons.print.min.js"></script>
    <script src="app.js"></script>
</body>
</html>